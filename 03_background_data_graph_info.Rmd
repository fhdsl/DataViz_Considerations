---
output: html_document
---

# Which visualization should I use?

A data visualization represents data in a simplified way. The visualization is made up of the represented data as well as the means by which the data is represented: textual and graphical design elements. Each conventional plot type utilizes a combination of design elements in a predictable way or layout. The design elements are the building blocks for the data visualizations. Deciding which design elements and plot type to use relies on several considerations: The type(s) and amount of data that you're visualizing as well as the question you are trying to answer or message you want to communicate.

## Learning Objectives

```{r fig.align = 'center', out.width = "100%", echo = FALSE, fig.alt = "This chapter will demonstrate how to describe the type or types of data within your dataset, explain how data is encoded within data visualizations, analyze which plot works with your data types and the question you want to answer, evaluate strengths and weaknesses of various standard plots, and identify resources that can help you choose which plot works for you."}
ottrpal::include_slide("https://docs.google.com/presentation/d/1fu-KfdN2ldOXB49o9zdpurFbVvl1bOh8cfQ3vu0szk4/edit?slide=id.g3a4b3643292_0_31#slide=id.g3a4b3643292_0_31")
```

## Data types

A dataset is a collection of records or observations. This course assumes that the dataset you are going to visualize has been processed and wrangled such that it is a "structured dataset." In structured datasets, typically each row (or "record") contains observations for a single sample or patient. Each column is a different observation or variable for that sample or patient. Every variable will be unique either because different things are being measured or documented or because the same thing is being measured at different time points. When thinking about the amount of data that will be displayed in a visualization, there are two different considerations: the number of observations (the number of rows) and the number of variables (which and how many columns).

<details><summary>Wide vs Long datasets</summary>

Some datasets may utilize a "long" approach to stack similar variables on top of each other with a new column helping to distinguish them and repeating record IDs across multiple rows; but this "long" approach is typically used as input to visualization software.

</details>

There are two main types of data within a dataset: **numerical** and **categorical** data. A dataset will likely have a mixture of these data types and new variables may be generated using the original data through transformations. Transformations can be used by performing mathemtical operations or converting between data types. Converting numerical data into categorical data is accomplished through binning or by employing a cutoff value. Alternatively, categorical data may need to be encoded as numerals so the data is in a form that requires less storage or so that a computer or algorithm can process it (e.g., machine readable). <ADD REF> There may be more specialized data types depending on your research question, such as relational or spatial data, but these tend to be just more complex and more defined format versions of numerical and categorical data.

### Numerical data

Numerical data is data that **quantitatitevly** represents some count or measurement. Mathematical operations such as addition, subtraction, division, multiplication, exponentiation, etc. are appropriate.

There are two subtypes of numerical data: *discrete* and *continuous*. Whole numbers or integers (e.g., 103 and 25,975) are examples of discrete data while decimals (e.g., 98.6 and 32.25) are examples of continuous data.

```{r eval = FALSE, fig.align = 'center', out.width = "100%", echo = FALSE, fig.alt = ""}
ottrpal::include_slide("")   
```

Examples of numerical data within the biomedical field include

* a blood test result value or concentration
* a patient's age
* the thickness of a tumor
* the length of stay for a patient at the hospital
* a survival probability

### Categorical data

Categorical data **qualitatively** characterizes, categorizes, or groups objects or individuals with labels. Categorical data sometimes may look like numbers when they are group IDs or some sort of ranking or index score. However, A-B-C could be switched out for 1-2-3 making such data categorical data.

Survey data frequently has categorical data that appears as numbers because responses are typically "coded". This is especially true for biomedical data from platforms like REDCap.

There are two subtypes of categorical data: *nominal* and *ordinal*. Nominal data is data that can't be ordered, for example "Case" and "Control". Ordinal data is data that can be ordered, for example "A", "B", "C" or "January 14, 1994", "February 8, 1995", "March 18, 1996".

While you may be able to do some arithmetic operations with ordinal data specifically (like finding an average ranking or finding the distance between numerically encoded categories), typically arithmetic operations aren't appropriate for categorical data and shouldn't be used because the numbers don't have mathematical meaning. Index scores particularly should be treated like categorical data given that they represent categories. However, they often have order to them (are oridinal) and therefore, because the index or score is fundamentally a number, it's made up of other numbers and can be tracked over time, etc.

```{r eval = FALSE, fig.align = 'center', out.width = "100%", echo = FALSE, fig.alt = ""}
ottrpal::include_slide("")   
```

Examples of categorical data within the biomeidcal field include

* patient or sample IDs
* treatment group
* patient sex
* tumor location
* Patient Health Questionnaire-9 (PHQ-9) Score / depression severity level <ADD REF>
* Charlson-Deyo Comorbidity Index <ADD REF>


## Data encodings

Data encoding is the process of representing data using visual elements or graphical attributes. These include geometric marks and visual channels which are the building blocks of data visualization. Different graph types utilize different encodings to represent data: geometric marks are typically the primary means of representing data across graph types while the visual channels are usually used as secondary or additional methods (e.g., shape, color, and textures). However, color can be a primary means of data encoding for certain graphs like heatmaps or choropleths <ADD REF>.   

### Geometric marks {.tabset}

These building blocks are also referred to as "geometric marks" and they include

* points
* lines
* bars
* area
* angle

#### Points {-}

An example of a conventional plot type that uses **points** is a scatter plot. Points typically are circles but can be other shapes (like triangles or squares), and typically represent one person or sample.

#### Lines {-}

An example of a convetional plot type that uses **lines** is a line plot. Lines connect different data points. Slope may be a value of interest when working with lines, but it's often difficult for audiences to compare slope values visually without labels. Lines may also be trendlines that aren't connecting explicit data points and rather are added to a plot to show a general relationship or trend. Lines are often used to add anootations for summary statistics such as averages as well as medians or quartiles (in boxplots).

#### Bars {-}

**Bars** use height (vertical bars) or length (horizontal bars) to communicate information about a set of samples. Within bar charts, width typically isn't used to communicate information about data, but for plot types like flow diagrams or histograms, bar width does convey a meaningful value.

#### Area {-}

**Area** is often proportional to the amount of data its representing rather than the raw data values itself. Larger areas correspond to larger data values. Area is commonly used in density plots

#### Angles {-}

**Angles** are most commonly used to represent numerical values such as proportions but can also be used to represent direction rather than just magnitude/size (through use of arrows or slope). Angles are the primary geometric mark used in pie charts.

### {-}

### Visual channels {.tabset}

These visual building blocks are also referred to as "visual channels" and they control the way that the geometric building blocks will appear. You can change the shape, color, or size of a point, but it's still a point. Visual channels include

* position
* shape
* line type
* color
* patterns
* size
* tilt

#### Position {-}

**Position** often reflects numerical value with marks that are near each other having more similar values than marks that are further away

#### Shape {-}

**Shape** may reflect categorization or group membership

#### Line type {-}

**Line types** can be used much like shape to communicate categorization or group membership

#### Color {-}

**Color** may reflect categorization or group membership

#### Pattern {-}

**Pattern** is sometimes used in place of or as a supplement to color to reflect categorization or group membership. For the recurring pattern to be recognized, it ofen needs to be used with geometric marks that have enough area for the pattern to be distinguishable.

#### Size {-}

**Size** is used to encode quantitative data by altering physical attributes of the geometric marks: thickness of a line, radius of a point, etc. Changes in size are often proportional to the quantiative data with larger sizes corresponding to larger values.

#### Tilt {-}

**Tilt** is another word for angles and can be used as a visual channel, not just a geometric mark. Tilt is used to represent proportions or trends (such as slope). While helpful for comparisons, audiences often find it difficult to compare tilt precisely and designers should not rely on tilt to communicate main messages.

### {-}

### Additional design tools {.tabset}

These additional design tools may or may not encode data, but do separate out data to enhance clarity and interpretability. The actual group membership will affect what is labeled or separated out, but often other visual design channels (like color) may be used to communicate group membership in a redundant way. These design tools are especially effective at improving the clarity of a visualization without having to change plot types. So if you're building a data visualization and it's a little too cluttered or difficult to interpet, try utilizing one of these design tools before switching plot types to a more complex plot type.

* labels
* facets or subplots
* transparency

#### Labels {-}

**Labels** include axis labels, titles, and direct annotations within the plot perhaps specifying a specific summary statistic/number or pointing out the name/value of a specific data point or line. They may be combined with dashed lines, colors, or other visual channels to add further clarity.

#### Subplots {-}

**Subplots**, also known as faceting, subplots separates out the data into different panels based on group membership. The same plot type will be utilized in each panel. Panels may or may not use the same scaling and axis limits.

#### Transparency {-}

**Transparency** controls the opacity of the geometric marks. If an area appears less transparent, there is a greater density of data there than areas that appear more transparent. This visual channel is especially helpful to distinguish groups that overlap.

### {-}

## Coordinate system

Most data visualizations will utilize a two dimensional XY coordinate system (or Cartesian plane) with a horizontal (x-) axis and a vertical (y-) axis that are perpendicular and intersect where x = 0 and y = 0. Each variable will be assigned to one of the axes. If working with regression or where you have a dependent varaible (outcome or event being measured or observed) and an independent variable (the variable being controlled or changed/purposefully manipulated), the independent variable is assigned to the x-axis and the dependent variable is assigned to the y-axis. When working with numerical data, this XY coordinate system allows for the positioning of the numerical data along these axes. When working with a categorical data, the categories can still be positioned along of the numerical axes, however the corresponding numerical positions will not have the same meaning they would otherwise have. The two axes can utilize different units (e..g, micrograms per milliliter, percentage, grams, log fold change, etc.) and scales, however, if the same units are used for the two axes, then the scaling should be equal for both axes to avoid distortion.

<details><summary>Additional coordinate systems</summary>

Additional coordinate systems are appropriate for some specific visualizations such as a three dimensional XYZ coordinate system, the polar coordinate system (e.g., pie charts and spider charts), and a geospatial coordiante system for maps such as the projected coordinate system.

  * The XYZ coordinate system adds a third axis (z-) that intersects the XY-plane perpendicularly at x = 0, y = 0, and z = 0.
  * The polar coordinate system uses angles to position groups and radii length to represent magnitude or group size.
  * A projected coordinate system is a two dimensional map.

</details>

## Goals of data visualization

There are many different possible goals for creating a data visualization. Among those include

* looking at a <u>distribution</u>
* showing a <u>correlation</u> or other relationship between variables
* finding a <u>ranking</u>
* displaying <u>change</u> over time or after an intervention
* indicating <u>location</u> and <u>spatial</u> relationships or distributions

## Standard graph types

Standard graph types include conventional graphs like histograms, scatter plots, bar plots, and line charts as well as other graphs used to look at distributions or find rankings or used to consider group composition, complex relationships, and response. For the conventional plots, this section will describe the appropriate kinds and amount of data needed to use that plot type as well as questions that plot type can be used to answer. For the graphs beyond those four, additional information will be provided such as a description, strengths, weaknesses, and alternative plots.

### Conventional graphs

Conventional graph types include histograms, scatter plots, bar plots, and line charts. Each of these are used to answer a different question.

|                             | Histogram | Scatter plot | Bar plot | Line chart |
|:----------------------------|:---------:|:------------:|:--------:|:----------:|
| Primary type of data        | Numerical | Numerical   | Numerical & Categorical | Numerical |
| Minimum number of variables | 1         | 2            | 2        | 2
| Primary data encoding       | Area and Position | Point and Position | Area & Labels/Position | Line and Position |
| Goal                        | looking at a distribution | showing a correlation | finding a ranking | displaying change over time |


<details><summary>Additional data and data encodings for conventional graph types</summary>

A *histogram* may visualize more than one distribution within the same visualization. In that case, the dataset will have categorical data and more than one variable. Such a visualization would likely incorporate color or patterns and should increase opacity/transparency.

A *scatter plot* may have categorical data that can be encoded with shape or color. Any additional numerical variables beyond the minimum of 2 (one for the x-axis and one for the y-axis) could be encoded with size or color (using a sequential color palette).

A *bar plot* tends to have categories and counts for those categories (two variables, one categorical and one numerical), though a dataset may have just the categories which would need to be counted (which some visualization software can do this for the researcher). Additional data could include some grouping or categorization of the categorical data (another categorical variable) in which case color may be used to encode that additional variable.

A *line chart* may or may not use points in addition to lines. It is good practice for the researcher to display the data points and not just the lines connecting them. If the dataset contains additional variables beyond the minimum of 2 (one for the x-axis and one for the y-axis), categorical data could be encoded with shape or color while numerical data could be encoded with size or color (using a sequential color palette).

</details>


### Ranking and distribution plots {.tabset}

These plots are primarily

#### Violin Plots {-}

**Description**: Displays the density of data where narrow sections correspond to lower density and wider sections correspond to higher density. The plots generally resemble the outline of a violin.

**When to use**:

  * Numerical data (may have categorical data if looking at multiple distributions)
  * Minimum of 1 variable
  * Best with minimal number of categories
  * Primary data encodings are area and position
  * Used to show distributions and rank groups

**Strengths**:

  * Better at comparing multiple distributions than histograms (the conventional plot type)
  * Displays distribution shape such as skey and modes better than boxplots do

**Weaknesses**:

  * Doesn't show individual data points
  * Limited usefulness when there's little amounts of data (e.g., few records/patients/samples)
  * The method for creating the density visualization is a bit arbitrary

**Alternatives**:

  * [Boxplot](https://www.data-to-viz.com/caveat/boxplot.html) (especially with jitter to show individual data points)
  * Ridgeline plot
  * Raincloud plot

**Example plot**

#### Boxplots (with jitter) {-}

**Description**: Boxplots use a box to delineate the median and quartiles of the data with whiskers to display the range and potentially points for outliers. A "jitter" can be utilized to add additional points for each data point.

<details><summary>Jitter and Randomness</details>

Additions of jitter typically use randomness to space the points over the box so you may need to set a random seed in your analysis to ensure the visualization appears exactly one way consistently. However, it's not a major problem if the jitter points move on a plot as they'll have the same numerical axis location, only moving within the categorical axis.

</summary>

**When to use**:

  * Numerical data (may have categorical data if looking at multiple distributions)
  * Minimum of 1 variable
  * Best if used with intermediate to large sample sizes
  * Primary data encodings are lines and points
  * Used to show distributions and rank groups

**Strengths**:

  * Shows the data as well as helpful summary statistics and overall variation
  * Can quickly spot outliers
  * Can compare groups efficiently

**Weaknesses**:

  * Doesn't show multiple modes as well as violin plots
  * Quartiles may not be familiar concepts for general audiences
  * Outliers need further investigation

**Alternatives**:

  * Violin plot
  * Histogram
  * Ridgeline plot
  * [Strip plot](https://datavizproject.com/data-type/strip-plot/) (shows the individual data points only)
  * Raincloud plot
  * Swarm plot

**Example plot**

#### Ridgeline plots {-}

**Description**: Shows the distribution of multiple categories of numerical data, using densitites (half a violin). Looks like stacked, but slightly offset mountain ridges.

**When to use**:

  * Numerical data (with categorical data for groups)
  * Minimum of 2 variables
  * Best with a higher number of categories
  * Primary data encodings are area and position
  * Used to show distributions and rank groups

**Strengths**:

  * Efficiently displays distributions for many groups or categories
  * Shows distribution shape (e.g., skew and modes)

**Weaknesses**:

  * Can be cluttered if there is too much overlap between groups or not a clear ordering of the categories
  * Good for general comparison among groups, but not for finding precise quantitative differences
  * The method for creating the density visualizations is a bit arbitrary

**Alternatives**:

  * [Boxplot](https://www.data-to-viz.com/caveat/boxplot.html) (especially with jitter to show individual data points)
  * [Strip plot](https://datavizproject.com/data-type/strip-plot/)
  * In some cases, a sorted [heatmap](https://www.data-to-viz.com/graph/heatmap.html)
  * A table may be better if you need to make quantitative comparisons

**Example plot**

#### Raincloud plots {-}

**Description**: Combines 3 plots: density, boxplot, individual data points. Generally looks like a raining cloud.

**When to use**:

  * Numerical data (with categorical data for groups)
  * Minimum of 1 variable
  * Best with minimal number of categories
  * Primary data encodings are area, lines, and points
  * Used to show distributions and rank groups

**Strengths**:

  * Show density/distribution shape as well as individual data points and common summary statistics -- so much information
  * Works well with small datasets

**Weaknesses**:

  * A lot is going on
  * Harder to interpet and cluttered or squished if there are more than a few groups

**Alternatives**:

  * [Violin plot](https://www.data-to-viz.com/graph/violin.html)
  * [Boxplot](https://www.data-to-viz.com/caveat/boxplot.html) (especially with jitter to show individual data points)
  * [Swarm plot](https://r-graph-gallery.com/beeswarm.html)

**Example plot**

### {-}

<u>The strengths of the plots that help you compare groups</u>

<b>Violin</b> plots are good if you want to look at distribution characteristics (e.g., skew or multimodality) at a glance.

<b>Boxplots</b> are great if you want to see the data and general summary statistics (e.g., median).

<b>Ridgeline</b> plots are great at comparing distributions of lots of groups.

<b>Raincloud</b> plots are great when you want to go deep and see everything for a small number of groups (exploratory analysis).

### Group composition, complex relationships, and response plots {.tabset}

#### Stacked bar charts {-}

**Description**: Displays multiple categories within a single bar, stacked on top (veritcal) or next to (horizontal) each other. Each overall bar represents a group. Within bars, each stack is a sub-category or subgroup.

**When to use**:

  * Numerical data with categorical data for groups
  * Minimum of 2 variables
  * Primary data encodings are bars, position, and color or pattern
  * Used to find a ranking or change over time
  * Compare sub-categories within a bar or consider how sub-category contribution to the total bar composition changes over time/across bars
  * Avoid if you have a lot of sub-categories or want to compare individual sub-categories to each other
  * If using more than a couple of categories, consider using proportions (that add up to 100%) on the numerical axis

**Strengths**:

  * Summarizes complex group composition in a compact way
  * Can compare composition over time or across groups

**Weaknesses**:

  * Difficulty comparing subgroups that aren't aligned or in the middle of the overall bar
  * If one subgroup contributes too much, it can dwarf other subgroups; similarly, if the groups have uneven sizes, it can dwarf other groups
  * If the numerical axis uses proportions, raw numbers aren't visualized

**Alternatives**:

  * Grouped bar chart
  * Lollipop plot
  * Line chart
  * A table
  * A waterfall plot for the most important sub-category

**Example plot**

#### Heatmaps {-}

**Description**: A visualization (typically two dimensional -- with rows and columns -- of a table or matrix) using color. Always uses colors to display numbers or categories; the two dimensional matrix while typical is not a requirement, because the two dimensions could be a map projection or tissue sample.  

**When to use**:

  * Categorical or numerical data or a mixture
  * Minimum of 3 variables
  * Primary data encodings are color and position
  * Used to look at a distribution across samples or change over time/after an intervetion
  * May also show pairwise correlation for many groups
  * Not recommended if you need to know or display actual values
  * Often used together with hierarchical clustering or reordering sample location to show trends or areas of similarity

**Strengths**:

  * Provides a broad overview to identify trends, areas of density, sparsity, or outliers
  * Efficiently and compactly simplifies complex data into one visualization

**Weaknesses**:

  * The "matrix" aspect can be difficult for viewers to grasp
  * Rearranging data can be helpful but also misleading if not described
  * Actual values and summary stats are rare/difficult to display if there are many rows and columns

**Alternatives**:

  * A [table](https://r-graph-gallery.com/table.html)
  * [Scatter](https://www.data-to-viz.com/graph/scatter.html) plot
  * [Line plot](https://www.data-to-viz.com/graph/line.html)
  * [Bubble charts](https://www.data-to-viz.com/graph/bubble.html) if another dimension is needed
  * [Parallel plot](https://www.data-to-viz.com/graph/parallel.html)

**Example plot**

  <details><summary>Pairwise correlation: Full matrix vs lower triangle</summary>

  When using a heatmap to display pairwise correlation, the heatmap is symmetrical and displays redundant information (each correlation is displayed twice) because the correlation of A to B is the same as the correlation of B to A. The diagonal will always have perfect correlation because it's comparing a sample or variable to itself. If looking at just the lower triangle, it shows the pairwise correlation only once and removes the redundant information.

  <details>

#### Sankey diagrams {-}

**Description**: Represents the "flow" or movement of quantities (e.g., patients or samples) among different categories through different steps (e.g., demographics or steps of an analysis or trial)

**When to use**:

  * Categorical data and sometimes numerical data/counts
  * Requires several variables
  * Primary data encodings are lines, area, and color
  * Used to show change over time
  * Best with datsets with some sort of longitudinal data or time points with categories at each time point
  * Examples uses include tracking patient response or syptom trajectories as well as patient cohort stratification

**Strengths**:

  * Provides a lot of information about the study population and shows all possible paths
  * Provides a visual or graphical representation of data that would otherwise be in a table or just described in text

**Weaknesses**:

  * Difficult or complex to interpet
  * Flows that cross or overlap or flows with similar widths can be difficult to compare though interactivity can alleviate this
  * Diagrams don't always clearly and explicitly show sample dropout (discontinue treatment, etc.)
  * Often require specialized tools to create visualization

**Alternatives**:

  * A table
  * Stacked bar charts, but these lose the connection/possible path aspect
  * Flowcharts
  * Treemaps
  * Other graphical visualizations or some custom made visualization

**Example plot**

### {-}

<u>The strengths of the plots for group composition, complex relationships, and response</u>

<b>Stacked bar</b> charts are good if you want to look at how subgroup composition changes at a glane over time, but it is less useful with lots of subgroups.

<b>Heatmaps</b> are good if you have at least 3 variables that you need to visualize and want to use color as the primary means to communicate the point of the visualization (e.g., the range of values, correlation, areas of density, patterns across groups or time)

<b>Sankey diagrams</b> are good if you want to look at the possible trajectories of symptoms, treatments, etc. and it's important to know what combinations occur.


### Field standard plots

There are additional common plots that are "field standard" or customarily used within the biomedical field. These plots (including Waterfall plots, Caterpillar plots, Kaplan-Meier curves, Volcano plots, MA diagrams, etc.) plots will be discussed in the final chapter. When deciding what plot is best for you and your research question, a field standard plot may be the answer given that the audience will be more familiar with such plots.

## Galleries

Galleries can be useful to browse standard plots and learn information about them.

An example of a gallery that provides visual examples and explanations for necessary data types is the [from Data to Viz gallery](https://www.data-to-viz.com/#explore)

For galleries that provide visual examples and templates on creating standard plots with programming languages, consider the [R Graph Gallery](https://r-graph-gallery.com/) or the [Python Graph Gallery](https://python-graph-gallery.com/).

For more specialized galleries related to biomedical applications, consider the [Substitutable Medical Apps, Reusable Technology (SMART) App Gallery](https://apps.smarthealthit.org/apps/category/data-visualization?sort=name-asc) which provides free and open source apps for healthcare providers and researchers to work with and visualize health data. The integrated apps describe specific data types and goals and can provide dashboards and visualizations specifically for those data types/goals.

Another more specialized gallery is the [Genomics Data Visualization course website](https://jef.works/genomic-data-visualization-2024/index.html) from the Johns Hopkins University Fan lab which provides featured visualizations meant for working with large-scale single-cell and spatially-resolved omics datasets using R.

Finally, publications provide a myriad of example visualizations working with field specific data. Reading publications, studying their figures, and critically evaluating the design choices is a wonderful way to improve your own data visualization skills. In the near future, as you read journal articles and look at the figures, ask yourself the following questions:

    * What was the goal or overarching message this visualization was meant to communicate?
    * What was difficult for me to understand about this figure and what design choices could have made this figure easier for me to follow along?
    * What did I like best about this visualization?
    * Are these visualizations standard/common plot types or were there any new (at least to me) visualizations? What was unique about them?

## Summary

There are strengths and weaknesses to every kind of plot. Some plots are better for exploratory analysis than for sharing with wide audiences. If exact quantitative values need to be considered, don't underestimate the power of a good table. When preparing an expository visualization, focus on one message.

Choosing which plot to use may be field, context, and data dependent. Use the simplest or most mainstream plot you can! Make sure that the plot works with your data type(s), number of variables, number of observations (e.g., patients or samples), and the overall goal or research question. Use design tools to develop your visualization before switching to a more complex plot. These design tools include utilizing facets or subplots, dashed lines and text labels, and varying colors, textures, or shapes. Finally, consider browsing a visualization gallery for inspiration!
